name: Audio Processing System CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test-demo:
    name: "ðŸ§ª Demo Tests"
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r pytest/requirements.txt
        
    - name: Run demo tests
      run: python pytest/demo_test.py


  test-categories:
    name: "ðŸ“‹ Test Categories"
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r pytest/requirements.txt
        
    - name: Run unit test demo
      run: |
        python -m pytest pytest/unit_tests/test_algorithms.py::TestAlgorithmA::test_algorithm_a_initialization -v \
          -p no:postgresql -p no:kubernetes
      
    - name: Run functional test demo  
      run: |
        python -m pytest pytest/functional_tests/test_end_to_end.py::TestEndToEndWorkflow::test_audio_processing_pipeline -v \
          -p no:postgresql -p no:kubernetes
      
    - name: Run performance test demo
      run: |
        python -m pytest pytest/performance_tests/test_load_performance.py::TestAlgorithmPerformance::test_algorithm_a_processing_time -v \
          -p no:postgresql -p no:kubernetes
      
    - name: Run security test demo
      run: |
        python -m pytest pytest/security_tests/test_security.py::TestAuthentication::test_jwt_validation -v \
          -p no:postgresql -p no:kubernetes